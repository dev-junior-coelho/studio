#!/bin/bash

# Script completo: Limpar + Seed + VerificaÃ§Ã£o
# Este script:
# 1. Deleta todos os produtos antigos
# 2. Faz seed com os 273 novos produtos (incluindo Dependente MÃ³vel)
# 3. Mostra estatÃ­sticas finais

set -e

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  ğŸš€ PROCESSO COMPLETO: LIMPAR + SEED + VERIFICAR"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Verificar Node.js
if ! command -v node &> /dev/null; then
    echo "âŒ Node.js nÃ£o encontrado. Instale em: https://nodejs.org/"
    exit 1
fi

echo "âœ… Node.js: $(node --version)"
echo "âœ… npm: $(npm --version)"
echo ""

# Ir para pasta do projeto
cd "$(dirname "$0")"
PROJECT_PATH="$(pwd)"
echo "ğŸ“ Projeto: $PROJECT_PATH"
echo ""

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo "FASE 1: LIMPANDO PRODUTOS ANTIGOS"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

if npx tsx clean-products.ts; then
    echo ""
    echo "âœ… Limpeza concluÃ­da!"
else
    echo "âŒ Erro na limpeza!"
    exit 1
fi

echo ""
echo "â³ Aguardando 2 segundos antes do seed..."
sleep 2

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ""
echo "FASE 2: FAZENDO SEED COM NOVOS PRODUTOS"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""

if npm run db:seed; then
    echo ""
    echo "âœ… Seed concluÃ­do!"
else
    echo "âŒ Erro no seed!"
    exit 1
fi

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "  âœ… SUCESSO! TUDO PRONTO!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

echo "ğŸ“Š PRÃ“XIMAS AÃ‡Ã•ES:"
echo "   1ï¸âƒ£  Acesse o builder: http://localhost:3000/app/builder"
echo "   2ï¸âƒ£  Procure por 'Dependente MÃ³vel'"
echo "   3ï¸âƒ£  Configure a quantidade (1-5 dependentes)"
echo "   4ï¸âƒ£  Cada um custa R$ 50,00/mÃªs"
echo ""

echo "ğŸ” VERIFICAÃ‡Ã•ES NO FIRESTORE:"
echo "   Console: https://console.firebase.google.com/"
echo "   Projeto: studio-878079588-1d0ae"
echo "   ColeÃ§Ã£o: produtos"
echo "   Total esperado: 273 documentos"
echo "   Dependente MÃ³vel: 1 produto"
echo ""

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
